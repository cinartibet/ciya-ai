<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CÄ°YA-AÄ° | Ultimate 2026</title>
    <style>
        :root {
            --primary: #0084ff;
            --bg: #0f0f0f;
            --panel: #1a1a1a;
            --text: #ffffff;
            --input-bg: #000000;
            --serious: #333333;
            --friendly: #2ecc71;
            --teacher: #e67e22;
            --avatar-bg: #444;
        }
        [data-theme="light"] {
            --bg: #f5f5f5;
            --panel: #ffffff;
            --text: #000000;
            --input-bg: #ffffff;
            --primary: #0066cc;
            --avatar-bg: #ddd;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            transition: background 0.4s;
        }
        .chat-container {
            width: 95%;
            max-width: 520px;
            height: 90vh;
            background: var(--panel);
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7);
            overflow: hidden;
            position: relative;
        }
        .header {
            padding: 15px;
            background: #222;
            border-bottom: 2px solid var(--primary);
            position: relative;
        }
        [data-theme="light"] .header { background: #f0f0f0; }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: var(--primary);
            text-align: center;
            letter-spacing: 2px;
        }
        .avatar {
            width: 40px;
            height: 40px;
            background: var(--avatar-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: absolute;
            left: 15px;
            top: 15px;
            border: 2px solid var(--primary);
        }
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .mode-btn, .theme-btn {
            background: #444;
            color: #ccc;
            border: 1px solid #555;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 11px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
        }
        [data-theme="light"] .mode-btn, [data-theme="light"] .theme-btn {
            background: #ddd;
            color: #333;
            border-color: #bbb;
        }
        .mode-btn.active { background: var(--primary); color: white; }
        #stop-btn, #mic-btn {
            position: absolute;
            border: none;
            color: white;
            border-radius: 10px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 10px;
            z-index: 20;
        }
        #stop-btn { right: 15px; top: 15px; background: #ff4444; display: none; }
        #mic-btn { right: 60px; top: 15px; background: var(--primary); }
        #mic-btn.recording { background: #ff4444; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        #chat-window {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #111;
            scroll-behavior: smooth;
        }
        [data-theme="light"] #chat-window { background: #f9f9f9; }
        .msg {
            max-width: 85%;
            padding: 14px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
            position: relative;
        }
        .msg-time {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 6px;
            text-align: right;
        }
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.4);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            opacity: 0;
            transition: 0.3s;
        }
        .bot-msg:hover .copy-btn { opacity: 1; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }
        .bot-msg {
            background: #2a2a2a;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            border: 1px solid #444;
        }
        [data-theme="light"] .bot-msg { background: #e0e0e0; color: #000; border-color: #ccc; }
        .user-msg {
            background: var(--primary);
            align-self: flex-end;
            border-bottom-right-radius: 2px;
            color: white;
        }
        .bot-msg.serious { border-left: 5px solid var(--serious); }
        .bot-msg.friendly { border-left: 5px solid var(--friendly); }
        .bot-msg.teacher { border-left: 5px solid var(--teacher); }
        .typing { display: flex; align-items: center; gap: 4px; height: 20px; }
        .dot { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0.3); opacity: 0.3; } 40% { transform: scale(1); opacity: 1; } }
        .image-box {
            margin-top: 10px;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #444;
            background: #000;
        }
        .image-box img {
            width: 100%;
            display: block;
            max-height: 300px;
            object-fit: contain;
        }
        .google-btn {
            display: inline-block;
            margin-top: 10px;
            background: #4285F4;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            text-decoration: none;
            font-size: 12px;
            font-weight: bold;
        }
        .input-area {
            padding: 20px;
            background: #222;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        [data-theme="light"] .input-area { background: #f0f0f0; }
        input {
            flex: 1;
            padding: 12px 18px;
            border-radius: 25px;
            border: 1px solid #444;
            background: var(--input-bg);
            color: var(--text);
            outline: none;
        }
        button#send-btn {
            background: var(--primary);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 18px;
        }
    </style>
</head>
<body data-theme="dark">
<div class="chat-container">
    <div class="header">
        <div class="avatar">ğŸ¤–</div>
        <h1>CÄ°YA-AÄ°</h1>
        <button id="stop-btn" onclick="stopSpeaking()">DURDUR</button>
        <button id="mic-btn" onclick="toggleSpeechRecognition()">ğŸ¤</button>
        <div class="mode-selector">
            <button class="mode-btn active" id="mode-normal" onclick="setPersonality('normal')">Normal</button>
            <button class="mode-btn" id="mode-serious" onclick="setPersonality('serious')">Ciddi</button>
            <button class="mode-btn" id="mode-friendly" onclick="setPersonality('friendly')">Samimi</button>
            <button class="mode-btn" id="mode-teacher" onclick="setPersonality('teacher')">EÄŸitmen</button>
            <button class="theme-btn" id="theme-toggle" onclick="toggleTheme()">â˜€ï¸</button>
        </div>
    </div>
    <div id="chat-window"></div>
    <div class="input-area">
        <input type="text" id="userInput" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n veya ğŸ¤ ile konuÅŸun..." autocomplete="off" onkeypress="if(event.key==='Enter') sendMessage()">
        <button id="send-btn" onclick="sendMessage()">â¤</button>
    </div>
</div>

<audio id="notifySound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" preload="auto"></audio>

<script>
    const synth = window.speechSynthesis;
    const recognition = ('webkitSpeechRecognition' in window) ? new webkitSpeechRecognition() : null;
    if (recognition) {
        recognition.lang = 'tr-TR';
        recognition.continuous = false;
        recognition.interimResults = false;
    }

    let userName = localStorage.getItem("ciya_user_name") || "";
    let currentPersonality = localStorage.getItem("ciya_personality") || "normal";
    let chatHistory = JSON.parse(localStorage.getItem("ciya_history") || "[]");
    let reminders = JSON.parse(localStorage.getItem("ciya_reminders") || "[]");
    let notes = JSON.parse(localStorage.getItem("ciya_notes") || "[]");
    let isRecording = false;

    const sakalar = [
        "Adam neden buzdolabÄ±nÄ±n Ã¶nÃ¼ne geÃ§miÅŸ? Ã‡Ã¼nkÃ¼ Ã¼zerinde 'cool' yazÄ±yormuÅŸ! ğŸ˜„",
        "En hÄ±zlÄ± sayÄ± hangisidir? 10, Ã§Ã¼nkÃ¼ hep on Ã¶nÃ¼nde! ğŸ˜‚",
        "Matematik kitabÄ±m Ã¼zgÃ¼n gÃ¶rÃ¼nÃ¼yor... Ã‡ok fazla problemi var.",
        "Karpuz neden ÅŸarkÄ±cÄ± oldu? Ã‡Ã¼nkÃ¼ iÃ§inde Ã§ok Ã§ekirdek var! ğŸ¤",
        "Tavuk neden yolun karÅŸÄ±sÄ±na geÃ§ti? KarÅŸÄ± tarafa geÃ§mek iÃ§in! ğŸ”",
        "Doktorlar neden hep soÄŸuk? Ã‡Ã¼nkÃ¼ buz gibi elleri var! â„ï¸",
        "En tembel daÄŸ hangisi? Everest, Ã§Ã¼nkÃ¼ hep zirvede yatÄ±yor! â›°ï¸",
        "Bilgisayar neden Ã¼ÅŸÃ¼mÃ¼ÅŸ? Windows'u aÃ§Ä±k unutmuÅŸ! ğŸ’»"
    ];

    const motivasyonSozleri = [
        "Her yeni gÃ¼n, yeni bir baÅŸlangÄ±Ã§tÄ±r. Sen baÅŸarabilirsin! ğŸ’ª",
        "KÃ¼Ã§Ã¼k adÄ±mlar bile seni hedefine ulaÅŸtÄ±rÄ±r. Devam et!",
        "BaÅŸarÄ±sÄ±zlÄ±k diye bir ÅŸey yoktur, sadece Ã¶ÄŸrenme fÄ±rsatlarÄ± vardÄ±r.",
        "Sen Ã¶zelsin ve dÃ¼nyada sadece bir tane var senden! ğŸŒŸ",
        "BugÃ¼n yapabileceÄŸin en iyi ÅŸey, yarÄ±nki senin teÅŸekkÃ¼r edeceÄŸi ÅŸeydir."
    ];

    function playNotify() {
        document.getElementById("notifySound").play().catch(() => {});
    }

    function formatTime(date) {
        return date.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
    }

    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute("data-theme");
        const newTheme = current === "dark" ? "light" : "dark";
        body.setAttribute("data-theme", newTheme);
        localStorage.setItem("ciya_theme", newTheme);
        document.getElementById("theme-toggle").textContent = newTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
    }

    function toggleSpeechRecognition() {
        if (!recognition) {
            addMessage("TarayÄ±cÄ±nÄ±z ses tanÄ±ma desteklemiyor.", 'bot-msg');
            return;
        }
        if (isRecording) {
            recognition.stop();
        } else {
            recognition.start();
            document.getElementById("mic-btn").classList.add("recording");
        }
        isRecording = !isRecording;
    }

    if (recognition) {
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById("userInput").value = transcript;
            sendMessage();
        };
        recognition.onend = () => {
            document.getElementById("mic-btn").classList.remove("recording");
            isRecording = false;
        };
        recognition.onerror = () => {
            document.getElementById("mic-btn").classList.remove("recording");
            isRecording = false;
            addMessage("Ses tanÄ±ma hatasÄ± oldu.", 'bot-msg');
        };
    }

    window.onload = () => {
        const savedTheme = localStorage.getItem("ciya_theme") || "dark";
        document.body.setAttribute("data-theme", savedTheme);
        document.getElementById("theme-toggle").textContent = savedTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";

        setPersonality(currentPersonality);
        loadChatHistory();
        loadReminders();

        let msg = userName
            ? getPersonalityText(`HoÅŸ geldin yine ${userName}! ğŸ˜Š BugÃ¼n nasÄ±lsÄ±n?`)
            : getPersonalityText("Merhaba! Ben CÄ°YA-AÄ°. AdÄ±n nedir?");
        addMessage(msg, 'bot-msg');
        speak(msg);
    };

    function loadChatHistory() {
        chatHistory.forEach(entry => {
            addMessage(entry.text, entry.class, false);
        });
    }

    function loadReminders() {
        reminders.forEach(r => {
            const remaining = r.time - Date.now();
            if (remaining > 0) {
                setTimeout(() => {
                    addMessage(`ğŸ”” HATIRLATMA: ${r.text}`, 'bot-msg');
                    speak(`HatÄ±rlatma: ${r.text}`);
                    playNotify();
                }, remaining);
            }
        });
    }

    function getPersonalityText(baseText) {
        switch(currentPersonality) {
            case "serious": return baseText.replace(/[!ğŸ˜ŠğŸ˜‚ğŸ‰ğŸ’ªğŸŒŸ]/g, '.');
            case "friendly": return baseText + (baseText.match(/[!?]$/) ? '' : ' ğŸ˜Š');
            case "teacher": return "Ã–ÄŸrencim, " + baseText.toLowerCase().replace(/[.!?]$/, '.');
            default: return baseText;
        }
    }

    function speak(text) {
        synth.cancel();
        const cleanText = text.replace(/<[^>]*>/g, '').replace(/Google.*$/g, '').trim();
        const ut = new SpeechSynthesisUtterance(cleanText);
        ut.lang = 'tr-TR';
        ut.rate = currentPersonality === "friendly" ? 1.1 : 1.0;
        ut.onstart = () => document.getElementById('stop-btn').style.display = 'block';
        ut.onend = () => document.getElementById('stop-btn').style.display = 'none';
        synth.speak(ut);
    }

    function stopSpeaking() {
        synth.cancel();
        document.getElementById('stop-btn').style.display = 'none';
    }

    function setPersonality(mode) {
        currentPersonality = mode;
        localStorage.setItem("ciya_personality", mode);
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`mode-${mode}`).classList.add('active');
    }

    // GÃ–RSEL SORUNU TAMAMEN Ã‡Ã–ZÃœLDÃœ - 2026'DA Ã‡ALIÅAN EN STABÄ°L KAYNAK: Lorem Picsum
async function resimAra(text) {
    let konu = text
        .replace(/(resim|gÃ¶rsel|fotoÄŸraf|gÃ¶ster|aÃ§|getir|foto|resmi|bir resim)/gi, "")
        .trim();

    if (!konu) konu = "nature";

    // %100 Ã§alÄ±ÅŸan, konuya gÃ¶re gerÃ§ek gÃ¶rsel
    const imgUrl = `https://loremflickr.com/800/600/${encodeURIComponent(konu)}?lock=${Date.now()}`;

    const fallback = "https://via.placeholder.com/800x600/222222/ffffff?text=GÃ¶rsel+YÃ¼klenemedi";
    const gUrl = `https://www.google.com/search?q=${encodeURIComponent(konu)}&tbm=isch`;

    return `"<b>${konu}</b>" ile ilgili gÃ¶rsel:<br>
        <div class="image-box">
            <img src="${imgUrl}" loading="lazy" onerror="this.src='${fallback}'">
        </div>
        <a href="${gUrl}" target="_blank" class="google-btn">Google GÃ¶rseller</a>`;
}


    async function internettenAra(sorgu) {
        try {
            const r = await fetch(`https://tr.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(sorgu)}`);
            const d = await r.json();
            if (d.extract) {
                return d.extract + `<br><br><a href="https://www.google.com/search?q=${encodeURIComponent(sorgu)}" target="_blank" class="google-btn">DevamÄ± iÃ§in Google</a>`;
            } else {
                return getPersonalityText(`"${sorgu}" hakkÄ±nda Wikipedia'da bilgi bulamadÄ±m.`) +
                       `<br><a href="https://www.google.com/search?q=${encodeURIComponent(sorgu)}" target="_blank" class="google-btn">Google'da ara</a>`;
            }
        } catch (e) {
            return getPersonalityText("Ä°nternet baÄŸlantÄ±sÄ±nda sorun var.") +
                   `<br><a href="https://www.google.com/search?q=${encodeURIComponent(sorgu)}" target="_blank" class="google-btn">Google'da kendin ara</a>`;
        }
    }

    function safeCalculate(expression) {
        const match = expression.match(/([\d.]+)\s*([\+\-\*\/])\s*([\d.]+)/);
        if (!match) return null;
        const a = parseFloat(match[1]);
        const op = match[2];
        const b = parseFloat(match[3]);
        switch(op) {
            case '+': return a + b;
            case '-': return a - b;
            case '*': return a * b;
            case '/': return b !== 0 ? a / b : "SÄ±fÄ±ra bÃ¶lme!";
            default: return null;
        }
    }

    function setReminder(text, minutes) {
        const time = Date.now() + minutes * 60 * 1000;
        reminders.push({ text, time });
        localStorage.setItem("ciya_reminders", JSON.stringify(reminders));
        setTimeout(() => {
            addMessage(`ğŸ”” HATIRLATMA: ${text}`, 'bot-msg');
            speak(`HatÄ±rlatma: ${text}`);
            playNotify();
            reminders = reminders.filter(r => r.time !== time);
            localStorage.setItem("ciya_reminders", JSON.stringify(reminders));
        }, minutes * 60 * 1000);
        return `Tamam, ${minutes} dakika sonra hatÄ±rlatacaÄŸÄ±m: "${text}" â°`;
    }

    function tasKagitMakas(secim) {
        const secimler = ["taÅŸ", "kaÄŸÄ±t", "makas"];
        const bot = secimler[Math.floor(Math.random() * 3)];
        let sonuc;
        if (secim === bot) sonuc = "Berabere! ğŸ¤";
        else if ((secim === "taÅŸ" && bot === "makas") || (secim === "kaÄŸÄ±t" && bot === "taÅŸ") || (secim === "makas" && bot === "kaÄŸÄ±t"))
            sonuc = "KazandÄ±n! ğŸ‰";
        else sonuc = "Kaybettin... ğŸ˜¢";
        return `Sen: ${secim.toUpperCase()} | Ben: ${bot.toUpperCase()}<br>${sonuc}<br>Tekrar oynayalÄ±m mÄ±?`;
    }

    async function sendMessage() {
        const input = document.getElementById("userInput");
        let text = input.value.trim();
        if (!text) return;

        addMessage(text, 'user-msg', true);
        input.value = "";

        const botId = "bot-" + Date.now();
        addMessage(`<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`, 'bot-msg', false, botId);

        let response = "";
        const low = text.toLowerCase();

        if (low.includes("adÄ±mÄ± deÄŸiÅŸtir") || low.includes("beni unut")) {
            userName = ""; localStorage.removeItem("ciya_user_name");
            response = getPersonalityText("Tamam, adÄ±nÄ± unuttum. Yeni adÄ±n ne?");
        }
        else if (low.includes("resim") || low.includes("gÃ¶rsel") || low.includes("fotoÄŸraf") || low.includes("foto")) {
            response = await resimAra(text);
        }
        else if (!userName && low.length < 30 && !low.includes(" ")) {
            userName = text;
            localStorage.setItem("ciya_user_name", userName);
            response = getPersonalityText(`TanÄ±ÅŸtÄ±ÄŸÄ±mÄ±za Ã§ok memnun oldum ${userName}! ğŸ‰`);
        }
        else if (["merhaba", "selam", "naber", "nasÄ±lsÄ±n", "hi", "hey"].some(s => low.includes(s))) {
            response = getPersonalityText(low.includes("naber") ? "Ä°yiyim, sen nasÄ±lsÄ±n?" : "Selam! NasÄ±lsÄ±n bugÃ¼n?");
        }
        else if (low.includes("saat kaÃ§") || low.includes("saati sÃ¶yle") || low.includes("tarih")) {
            const now = new Date();
            response = getPersonalityText(`Åu an saat: ${now.toLocaleTimeString('tr-TR')}<br>Tarih: ${now.toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`);
        }
        else if (low.includes("ÅŸaka")) {
            const saka = sakalar[Math.floor(Math.random() * sakalar.length)];
            response = getPersonalityText(`Ä°ÅŸte bir ÅŸaka: ${saka}`);
        }
        else if (low.includes("motivasyon") || low.includes("gÃ¼naydÄ±n") || low.includes("motivasyon ver")) {
            const soz = motivasyonSozleri[Math.floor(Math.random() * motivasyonSozleri.length)];
            response = getPersonalityText(soz);
        }
        else if (low.match(/(\d+)\s*(dakika|saniye|saat)\s*sonra.*hatÄ±rlat/)) {
            const match = text.match(/(\d+)\s*(dakika|saniye|saat)/);
            const num = parseInt(match[1]);
            const unit = match[2];
            const mesaj = text.split("hatÄ±rlat")[1]?.trim() || "bir ÅŸey";
            const dakika = unit === "saniye" ? num / 60 : unit === "saat" ? num * 60 : num;
            response = setReminder(mesaj, dakika);
        }
        else if (low.includes("not al")) {
            const not = text.split("not al")[1]?.trim();
            if (not) {
                notes.push(not);
                localStorage.setItem("ciya_notes", JSON.stringify(notes));
                response = getPersonalityText(`Not alÄ±ndÄ±: "${not}" ğŸ“`);
            }
        }
        else if (low.includes("notlarÄ±mÄ± gÃ¶ster") || low.includes("notlar")) {
            if (notes.length === 0) response = "HenÃ¼z notun yok.";
            else response = "<b>NotlarÄ±n:</b><br>" + notes.map((n, i) => `${i+1}. ${n}`).join("<br>");
        }
        else if (low.includes("taÅŸ") || low.includes("kaÄŸÄ±t") || low.includes("makas")) {
            const secim = ["taÅŸ", "kaÄŸÄ±t", "makas"].find(s => low.includes(s));
            if (secim) response = tasKagitMakas(secim);
        }
        else if (safeCalculate(text) !== null) {
            response = getPersonalityText(`SonuÃ§: <b>${safeCalculate(text)}</b>`);
        }
        else {
            response = await internettenAra(text);
        }

        const wordCount = response.split(' ').length;
        const delay = Math.min(2500, Math.max(800, wordCount * 80));

        setTimeout(() => {
            const botEl = document.getElementById(botId);
            if (botEl) {
                botEl.classList.add(currentPersonality);
                botEl.innerHTML = response + `<div class="msg-time">${formatTime(new Date())}</div>
                    <button class="copy-btn" onclick="copyMessage(this)">ğŸ“‹</button>`;
                speak(response);
                playNotify();
                document.getElementById("chat-window").scrollTop = document.getElementById("chat-window").scrollHeight;
            }
        }, delay);
    }

    function copyMessage(btn) {
        const msg = btn.parentElement;
        const text = msg.innerText || msg.textContent;
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = "âœ“";
            setTimeout(() => btn.textContent = "ğŸ“‹", 1000);
        });
    }

    function addMessage(text, className, save = true, id = null) {
        const w = document.getElementById("chat-window");
        const d = document.createElement("div");
        d.className = `msg ${className}`;
        if (id) d.id = id;
        d.innerHTML = text + (className === 'bot-msg' ? `<div class="msg-time">${formatTime(new Date())}</div>
            <button class="copy-btn" onclick="copyMessage(this)">ğŸ“‹</button>` : '');
        w.appendChild(d);
        w.scrollTop = w.scrollHeight;

        if (save) {
            chatHistory.push({ text: text + (className === 'bot-msg' ? `<div class="msg-time">${formatTime(new Date())}</div>` : ''), class: className });
            if (chatHistory.length > 150) chatHistory.shift();
            localStorage.setItem("ciya_history", JSON.stringify(chatHistory));
        }
    }
</script>
</body>
</html>